<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Pro Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∏–ø–æ–≤ */
        .chip { transition: all 0.2s; cursor: pointer; border: 1px solid #475569; }
        .chip:hover { background-color: #334155; }
        .chip.active { background-color: #fbbf24; color: #000; border-color: #fbbf24; font-weight: bold; transform: scale(1.05); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Drag & Drop */
        .draggable-item { cursor: grab; transition: transform 0.2s, box-shadow 0.2s; }
        .draggable-item:active { cursor: grabbing; }
        .draggable-item.dragging { opacity: 0.5; border: 2px dashed #fbbf24; background: #1e293b; }
        .drag-over { border-top: 2px solid #fbbf24; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

<div class="max-w-5xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-2">
            Nano Banana Builder Pro üçå
        </h1>
        <p class="text-slate-400">Drag & Drop –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="space-y-6">
            <div class="glass-panel p-6 rounded-2xl shadow-lg">
                <label class="block text-yellow-400 font-bold mb-2 text-lg">–ß—Ç–æ —Ä–∏—Å—É–µ–º?</label>
                <textarea id="mainSubject" rows="2" placeholder="–û–ø–∏—à–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç..."
                          class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white focus:ring-2 focus:ring-yellow-400 outline-none"></textarea>
            </div>

            <div>
                <label class="block text-xs uppercase text-slate-500 mb-2 font-bold tracking-wider">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º—Ç–∞ (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –±–ª–æ–∫–∏):</label>
                <div id="activeModules" class="space-y-3 min-h-[50px]">
                </div>
            </div>

            <div class="pt-2">
                <button onclick="openModal()" class="w-full py-4 border-2 border-dashed border-slate-600 rounded-2xl text-slate-400 hover:border-yellow-400 hover:text-yellow-400 transition-all flex justify-center items-center gap-2 group">
                    <span class="text-2xl group-hover:scale-110 transition-transform">+</span> –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
                </button>
            </div>
        </div>

        <div class="sticky top-6 h-fit">
            <div class="glass-panel p-6 rounded-2xl shadow-lg border-yellow-500/30">
                <h2 class="text-xl font-bold text-white mb-4 uppercase tracking-widest">Final Prompt</h2>
                <div id="finalPrompt" class="w-full min-h-[150px] bg-black/50 rounded-xl p-4 text-slate-200 font-mono text-lg border border-slate-700 leading-relaxed mb-6 overflow-y-auto max-h-[400px]">
                    Start building...
                </div>
                <button onclick="copyPrompt()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-4 rounded-xl shadow-lg transition-all flex justify-center items-center gap-2 active:scale-95">
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç
                </button>
            </div>
        </div>
    </div>
</div>

<div id="modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
    <div class="glass-panel w-full max-w-2xl p-6 md:p-8 rounded-3xl flex flex-col max-h-[90vh]">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-white">–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä</h3>
            <button onclick="closeModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
        </div>

        <div class="space-y-5 overflow-y-auto pr-2 custom-scroll">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–ì—Ä—É–ø–ø–∞</label>
                    <select id="groupSelect" onchange="updateTypes()" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-600 text-white outline-none focus:border-yellow-500"></select>
                </div>
                <div>
                    <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–¢–∏–ø</label>
                    <select id="typeSelect" onchange="renderChips()" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-600 text-white outline-none focus:border-yellow-500"></select>
                </div>
            </div>

            <div>
                <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                <div id="chipsContainer" class="flex flex-wrap gap-2">
                </div>
            </div>

            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 min-h-[80px]">
                <span class="text-xs text-yellow-500 uppercase font-bold block mb-1">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</span>
                <p id="descriptionText" class="text-slate-300 text-sm italic">–í—ã–±–µ—Ä–∏—Ç–µ —á–∏–ø –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ...</p>
            </div>
        </div>

        <div class="pt-6 mt-auto">
            <button onclick="addSelectedParameter()" id="addBtn" disabled class="w-full py-3 bg-yellow-500 text-black font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-yellow-400 transition">
                –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º—Ç
            </button>
        </div>
    </div>
</div>

<script>
    // === 1. JSON CONFIGURATION (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û –î–õ–Ø GEMINI) ===
    // –ú—ã –º–µ–Ω—è–µ–º val –Ω–∞ —Ñ—Ä–∞–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–≤—É—á–∞—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
    const PROMPT_CONFIG = {
        "–ö–∞–º–µ—Ä–∞": {
            "–†–∞–∫—É—Ä—Å": [
                { val: "Viewed from a drone perspective", desc: "–í–∏–¥ —Å –¥—Ä–æ–Ω–∞. –°—ä–µ–º–∫–∞ —Å –±–æ–ª—å—à–æ–π –≤—ã—Å–æ—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±." },
                { val: "Shot from a low angle looking up", desc: "–ù–∏–∂–Ω–∏–π —Ä–∞–∫—É—Ä—Å. –ö–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö, –æ–±—ä–µ–∫—Ç –∫–∞–∂–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–º." },
                { val: "Captured at eye level", desc: "–ù–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑. –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –≤–∑–≥–ª—è–¥." },
                { val: "Top-down flat lay view", desc: "–°—Ç—Ä–æ–≥–æ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤." }
            ],
            "–û–±—ä–µ–∫—Ç–∏–≤": [
                { val: "Extreme close-up macro shot", desc: "–ú–∞–∫—Ä–æ—Å—ä–µ–º–∫–∞. –í–∏–¥–Ω—ã –º–µ–ª—å—á–∞–π—à–∏–µ —Ç–µ–∫—Å—Ç—É—Ä—ã." },
                { val: "Shot with a wide-angle fisheye lens", desc: "–†—ã–±–∏–π –≥–ª–∞–∑. –°–∏–ª—å–Ω–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ, –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏–π –æ–±–∑–æ—Ä." },
                { val: "Photographed with a 35mm lens", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ 35–º–º. –ö–∏–Ω–æ—à–Ω–æ–µ, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ." },
                { val: "Long-range telephoto shot", desc: "–¢–µ–ª–µ–æ–±—ä–µ–∫—Ç–∏–≤. –°–∂–∞—Ç–∞—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞, —Ä–∞–∑–º—ã—Ç—ã–π —Ñ–æ–Ω." }
            ]
        },
        "–°–≤–µ—Ç": {
            "–í—Ä–µ–º—è": [
                { val: "Illuminated by soft golden hour sunlight", desc: "–ó–æ–ª–æ—Ç–æ–π —á–∞—Å. –¢–µ–ø–ª—ã–π —Å–≤–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–∫–∞—Ç–æ–º." },
                { val: "Lighting typical of the blue hour", desc: "–°–∏–Ω–∏–π —á–∞—Å. –•–æ–ª–æ–¥–Ω–æ–µ —Å—É–º–µ—Ä–µ—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ." },
                { val: "Under harsh midday sun", desc: "–ñ–µ—Å—Ç–∫–æ–µ –ø–æ–ª—É–¥–µ–Ω–Ω–æ–µ —Å–æ–ª–Ω—Ü–µ —Å —Ä–µ–∑–∫–∏–º–∏ —Ç–µ–Ω—è–º–∏." }
            ],
            "–¢–∏–ø": [
                { val: "Bathed in neon cyberpunk lighting", desc: "–ù–µ–æ–Ω. –Ø—Ä–∫–∏–µ —Ü–≤–µ—Ç–Ω—ã–µ –æ–≥–Ω–∏ –≤ —Ç–µ–º–Ω–æ—Ç–µ." },
                { val: "Lit by professional studio lighting", desc: "–°—Ç—É–¥–∏–π–Ω—ã–π —Å–≤–µ—Ç. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤." },
                { val: "Illuminated by warm candlelight", desc: "–°–≤–µ—Ç —Å–≤–µ—á–∏. –£—é—Ç–Ω–∞—è, –∏–Ω—Ç–∏–º–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞." }
            ],
            "–≠—Ñ—Ñ–µ–∫—Ç—ã": [
                { val: "Featuring volumetric God rays", desc: "–û–±—ä–µ–º–Ω—ã–µ –ª—É—á–∏ —Å–≤–µ—Ç–∞ (God rays) —Å–∫–≤–æ–∑—å –¥—ã–º–∫—É." },
                { val: "With dramatic cinematic high-contrast lighting", desc: "–ö–∏–Ω–æ—à–Ω—ã–π –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π —Å–≤–µ—Ç." }
            ]
        },
        "–°—Ç–∏–ª—å": {
            "–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π": [
                { val: "Oil painting style with visible brushstrokes", desc: "–ú–∞—Å–ª–æ. –í–∏–¥–Ω—ã –º–∞–∑–∫–∏ –∫–∏—Å—Ç–∏." },
                { val: "Loose watercolor painting style", desc: "–ê–∫–≤–∞—Ä–µ–ª—å. –õ–µ–≥–∫–∞—è, –≤–æ–∑–¥—É—à–Ω–∞—è, —Å –ø–æ—Ç–µ–∫–∞–º–∏." },
                { val: "Charcoal pencil sketch", desc: "–£–≥–æ–ª—å–Ω—ã–π –Ω–∞–±—Ä–æ—Å–æ–∫. –ì—Ä–∞—Ñ–∏—á–Ω–æ, —á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ." }
            ],
            "–¶–∏—Ñ—Ä–æ–≤–æ–π": [
                { val: "Rendered in Unreal Engine 5", desc: "–ì–∏–ø–µ—Ä—Ä–µ–∞–ª–∏–∑–º –∏–≥—Ä–æ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫–∏." },
                { val: "In the style of a claymation movie", desc: "–ü–ª–∞—Å—Ç–∏–ª–∏–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è." },
                { val: "Low-poly 3D art style", desc: "–ù–∏–∑–∫–æ–ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–∞—è 3D –≥—Ä–∞—Ñ–∏–∫–∞." },
                { val: "Grainy vintage film aesthetics", desc: "–≠—Å—Ç–µ—Ç–∏–∫–∞ —Å—Ç–∞—Ä–æ–π –∑–µ—Ä–Ω–∏—Å—Ç–æ–π –ø–ª–µ–Ω–∫–∏." }
            ]
        }
    };

    let activeParams = [];
    let tempSelection = null;

    // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –õ–û–ì–ò–ö–ê ===

    function initSelectors() {
        const groupSelect = document.getElementById('groupSelect');
        groupSelect.innerHTML = Object.keys(PROMPT_CONFIG).map(g => `<option value="${g}">${g}</option>`).join('');
        updateTypes();
    }

    function updateTypes() {
        const group = document.getElementById('groupSelect').value;
        const typeSelect = document.getElementById('typeSelect');
        typeSelect.innerHTML = Object.keys(PROMPT_CONFIG[group]).map(t => `<option value="${t}">${t}</option>`).join('');
        renderChips();
    }

    function renderChips() {
        const group = document.getElementById('groupSelect').value;
        const type = document.getElementById('typeSelect').value;
        const container = document.getElementById('chipsContainer');

        container.innerHTML = '';
        document.getElementById('descriptionText').innerText = "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∏–ø, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ...";
        document.getElementById('addBtn').disabled = true;
        tempSelection = null;

        PROMPT_CONFIG[group][type].forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'chip bg-slate-700 text-slate-200 px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-all hover:bg-slate-600';
            btn.innerText = item.val.split(' ').slice(0, 3).join(' ') + '...'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 3 —Å–ª–æ–≤–∞ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
            btn.title = item.val; // –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏

            btn.onclick = () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('descriptionText').innerText = item.desc;
                tempSelection = { ...item, typeName: type };
                document.getElementById('addBtn').disabled = false;
            };
            container.appendChild(btn);
        });
    }

    function addSelectedParameter() {
        if(!tempSelection) return;
        const newParam = {
            id: Date.now(),
            type: tempSelection.typeName,
            value: tempSelection.val, // –ó–¥–µ—Å—å —Ç–µ–ø–µ—Ä—å –¥–ª–∏–Ω–Ω–∞—è —Ñ—Ä–∞–∑–∞
            desc: tempSelection.desc
        };
        activeParams.push(newParam);
        renderList();
        generatePrompt();
        closeModal();
    }

    function removeParam(id) {
        activeParams = activeParams.filter(p => p.id !== id);
        renderList();
        generatePrompt();
    }

    // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ (Drag & Drop –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å –ø—Ä–µ–∂–Ω–µ–π)
    function renderList() {
        const container = document.getElementById('activeModules');
        container.innerHTML = '';
        activeParams.forEach((param, index) => {
            const el = document.createElement('div');
            el.className = 'draggable-item glass-panel p-3 rounded-xl flex justify-between items-center border-l-4 border-yellow-500 mb-2';
            el.setAttribute('draggable', 'true');
            el.dataset.index = index;
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –∏ —Å–∞–º—É —Ñ—Ä–∞–∑—É
            el.innerHTML = `
                <div class="flex items-center gap-3 overflow-hidden">
                    <div class="cursor-grab text-slate-500 hover:text-white shrink-0">
                        <svg width="12" height="20" viewBox="0 0 6 10" fill="currentColor"><circle cx="1" cy="1" r="1"/><circle cx="1" cy="5" r="1"/><circle cx="1" cy="9" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="5" cy="5" r="1"/><circle cx="5" cy="9" r="1"/></svg>
                    </div>
                    <div class="truncate">
                        <span class="text-[10px] uppercase text-slate-400 block tracking-wider">${param.type}</span>
                        <span class="text-white font-medium text-sm truncate block" title="${param.value}">${param.value}</span>
                    </div>
                </div>
                <button onclick="removeParam(${param.id})" class="text-slate-500 hover:text-red-400 p-2 text-xl shrink-0">&times;</button>
            `;
            addDnDEvents(el);
            container.appendChild(el);
        });
    }

    // === –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –õ–û–ì–ò–ö–ê –°–ë–û–†–ö–ò ===
    function generatePrompt() {
        const subject = document.getElementById('mainSubject').value.trim();
        let parts = [];

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—É–±—ä–µ–∫—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—Å–∞–ª –ø–æ–ª–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
        if (subject) {
            // –ï—Å–ª–∏ —Å—É–±—ä–µ–∫—Ç –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ—á–∫—É, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É
            let cleanSubject = subject;
            if(!cleanSubject.endsWith('.') && !cleanSubject.endsWith('!') && !cleanSubject.endsWith('?')) {
                cleanSubject += '.';
            }
            parts.push(cleanSubject);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
        activeParams.forEach(p => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Ñ—Ä–∞–∑–∞ —Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã (–¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
            let val = p.value;
            // val = val.charAt(0).toUpperCase() + val.slice(1); // –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            parts.push(val);
        });

        // –°–æ–µ–¥–∏–Ω—è–µ–º —á–µ—Ä–µ–∑ –¢–û–ß–ö–£ + –ü–†–û–ë–ï–õ. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
        const finalStr = parts.join(' ');
        // –ò–ª–∏ parts.join('. ') –µ—Å–ª–∏ —Ñ—Ä–∞–∑—ã –≤ JSON –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —Ç–æ—á–∫–∞–º–∏,
        // –Ω–æ –≤ –º–æ–µ–º –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ —è —Å–¥–µ–ª–∞–ª —Ñ—Ä–∞–∑—ã –±–µ–∑ —Ç–æ—á–µ–∫, –ø–æ—ç—Ç–æ–º—É –ª—É—á—à–µ join('. ')

        // –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö —Ç–æ—á–µ–∫
        const out = document.getElementById('finalPrompt');
        if(parts.length > 0) {
            // –°–æ–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É, –µ—Å–ª–∏ –≤ —Å–∞–º–∏—Ö —Ñ—Ä–∞–∑–∞—Ö —Ç–æ—á–µ–∫ –Ω–µ—Ç
            out.innerText = parts.join('. ') + (parts.length > 0 && !parts[parts.length-1].endsWith('.') ? '.' : '');
            out.classList.remove('text-slate-500');
            out.classList.add('text-white');
        } else {
            out.innerText = "–î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç...";
            out.classList.add('text-slate-500');
        }
    }

    // Drag & Drop —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–µ –∂–µ, —á—Ç–æ –∏ –±—ã–ª–∏)
    let dragSrcIndex = null;
    function addDnDEvents(item) {
        item.addEventListener('dragstart', (e) => {
            dragSrcIndex = +item.dataset.index;
            item.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        });
        item.addEventListener('dragend', () => {
            item.classList.remove('dragging');
            document.querySelectorAll('.draggable-item').forEach(el => el.classList.remove('drag-over'));
        });
        item.addEventListener('dragover', (e) => { e.preventDefault(); return false; });
        item.addEventListener('dragenter', () => { item.classList.add('drag-over'); });
        item.addEventListener('dragleave', () => { item.classList.remove('drag-over'); });
        item.addEventListener('drop', (e) => {
            e.stopPropagation();
            const dropIndex = +item.dataset.index;
            if (dragSrcIndex !== dropIndex) {
                const movedItem = activeParams[dragSrcIndex];
                activeParams.splice(dragSrcIndex, 1);
                activeParams.splice(dropIndex, 0, movedItem);
                renderList();
                generatePrompt();
            }
            return false;
        });
    }

    function copyPrompt() {
        const text = document.getElementById('finalPrompt').innerText;
        navigator.clipboard.writeText(text);
        const btn = document.querySelector('button[onclick="copyPrompt()"]');
        const old = btn.innerText;
        btn.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! ‚úÖ";
        setTimeout(() => btn.innerText = old, 2000);
    }

    function openModal() {
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('modal').classList.add('flex');
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        document.getElementById('addBtn').disabled = true;
        document.getElementById('descriptionText').innerText = "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∏–ø...";
    }
    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    document.getElementById('mainSubject').addEventListener('input', generatePrompt);
    initSelectors();
</script>
</body>
</html>