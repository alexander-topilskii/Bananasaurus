<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Pro Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–µ–π */
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∏–ø–æ–≤ */
        .chip { transition: all 0.2s; cursor: pointer; border: 1px solid #475569; }
        .chip:hover { background-color: #334155; }
        .chip.active { background-color: #fbbf24; color: #000; border-color: #fbbf24; font-weight: bold; transform: scale(1.05); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Drag & Drop */
        .draggable-item { cursor: grab; transition: transform 0.2s, box-shadow 0.2s; }
        .draggable-item:active { cursor: grabbing; }
        .draggable-item.dragging { opacity: 0.5; border: 2px dashed #fbbf24; background: #1e293b; }
        .drag-over { border-top: 2px solid #fbbf24; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

<div class="max-w-5xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 mb-2">
            Nano Banana Builder Pro üçå
        </h1>
        <p class="text-slate-400">Drag & Drop –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="space-y-6">
            <div class="glass-panel p-6 rounded-2xl shadow-lg">
                <label class="block text-yellow-400 font-bold mb-2 text-lg">–ß—Ç–æ —Ä–∏—Å—É–µ–º?</label>
                <textarea id="mainSubject" rows="2" placeholder="–û–ø–∏—à–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç..."
                          class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white focus:ring-2 focus:ring-yellow-400 outline-none"></textarea>
            </div>

            <div>
                <label class="block text-xs uppercase text-slate-500 mb-2 font-bold tracking-wider">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º—Ç–∞ (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –±–ª–æ–∫–∏):</label>
                <div id="activeModules" class="space-y-3 min-h-[50px]">
                </div>
            </div>

            <div class="pt-2">
                <button onclick="openModal()" class="w-full py-4 border-2 border-dashed border-slate-600 rounded-2xl text-slate-400 hover:border-yellow-400 hover:text-yellow-400 transition-all flex justify-center items-center gap-2 group">
                    <span class="text-2xl group-hover:scale-110 transition-transform">+</span> –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
                </button>
            </div>
        </div>

        <div class="sticky top-6 h-fit">
            <div class="glass-panel p-6 rounded-2xl shadow-lg border-yellow-500/30">
                <h2 class="text-xl font-bold text-white mb-4 uppercase tracking-widest">Final Prompt</h2>
                <div id="finalPrompt" class="w-full min-h-[150px] bg-black/50 rounded-xl p-4 text-slate-200 font-mono text-lg border border-slate-700 leading-relaxed mb-6 overflow-y-auto max-h-[400px]">
                    Start building...
                </div>
                <button onclick="copyPrompt()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-4 rounded-xl shadow-lg transition-all flex justify-center items-center gap-2 active:scale-95">
                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç
                </button>
            </div>
        </div>
    </div>
</div>

<div id="modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
    <div class="glass-panel w-full max-w-2xl p-6 md:p-8 rounded-3xl flex flex-col max-h-[90vh]">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-white">–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä</h3>
            <button onclick="closeModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
        </div>

        <div class="space-y-5 overflow-y-auto pr-2 custom-scroll">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–ì—Ä—É–ø–ø–∞</label>
                    <select id="groupSelect" onchange="updateTypes()" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-600 text-white outline-none focus:border-yellow-500"></select>
                </div>
                <div>
                    <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–¢–∏–ø</label>
                    <select id="typeSelect" onchange="renderChips()" class="w-full bg-slate-800 p-3 rounded-xl border border-slate-600 text-white outline-none focus:border-yellow-500"></select>
                </div>
            </div>

            <div>
                <label class="block text-xs uppercase text-slate-400 mb-2 font-bold">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                <div id="chipsContainer" class="flex flex-wrap gap-2">
                </div>
            </div>

            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 min-h-[80px]">
                <span class="text-xs text-yellow-500 uppercase font-bold block mb-1">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</span>
                <p id="descriptionText" class="text-slate-300 text-sm italic">–í—ã–±–µ—Ä–∏—Ç–µ —á–∏–ø –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ...</p>
            </div>
        </div>

        <div class="pt-6 mt-auto">
            <button onclick="addSelectedParameter()" id="addBtn" disabled class="w-full py-3 bg-yellow-500 text-black font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:bg-yellow-400 transition">
                –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–æ–º—Ç
            </button>
        </div>
    </div>
</div>

<script>
    // === 1. JSON KONFIGURATION (–° –û–ü–ò–°–ê–ù–ò–Ø–ú–ò) ===
    const PROMPT_CONFIG = {
        "–°–≤–µ—Ç": {
            "–í—Ä–µ–º—è —Å—É—Ç–æ–∫": [
                { val: "Golden hour", desc: "–ó–æ–ª–æ—Ç–æ–π —á–∞—Å. –ú—è–≥–∫–∏–π, —Ç–µ–ø–ª—ã–π, –æ–±—ä–µ–º–Ω—ã–π —Å–≤–µ—Ç –ø–µ—Ä–µ–¥ –∑–∞–∫–∞—Ç–æ–º. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ –∏ –ø–µ–π–∑–∞–∂–µ–π." },
                { val: "Blue hour", desc: "–°–∏–Ω–∏–π —á–∞—Å. –°—É–º–µ—Ä–µ—á–Ω–æ–µ, —Ö–æ–ª–æ–¥–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–∫–∞—Ç–∞. –°–æ–∑–¥–∞–µ—Ç –º–µ–ª–∞–Ω—Ö–æ–ª–∏—é." },
                { val: "Midday sun", desc: "–ñ–µ—Å—Ç–∫–∏–π –ø–æ–ª—É–¥–µ–Ω–Ω—ã–π —Å–≤–µ—Ç. –ß–µ—Ç–∫–∏–µ, —Ä–µ–∑–∫–∏–µ —Ç–µ–Ω–∏. –í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç." }
            ],
            "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π": [
                { val: "Neon lighting", desc: "–Ø—Ä–∫–∏–µ –Ω–µ–æ–Ω–æ–≤—ã–µ –æ–≥–Ω–∏ (–∫–∏–±–µ—Ä–ø–∞–Ω–∫). –†–æ–∑–æ–≤—ã–µ, –≥–æ–ª—É–±—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏, –≥–ª—É–±–æ–∫–∏–µ —Ç–µ–Ω–∏." },
                { val: "Studio lighting", desc: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç—É–¥–∏–π–Ω—ã–π —Å–≤–µ—Ç. –ò–¥–µ–∞–ª—å–Ω–∞—è –∫–æ–∂–∞, –º—è–≥–∫–∏–µ —Ç–µ–Ω–∏, —Å–æ—Ñ—Ç–±–æ–∫—Å—ã." },
                { val: "Candlelight", desc: "–°–≤–µ—Ç –æ—Ç —Å–≤–µ—á–∏. –û—á–µ–Ω—å —Ç–µ–ø–ª—ã–π, –º–µ—Ä—Ü–∞—é—â–∏–π, –∏–Ω—Ç–∏–º–Ω—ã–π —Å–≤–µ—Ç —Å –≥–ª—É–±–æ–∫–∏–º–∏ —Ç–µ–Ω—è–º–∏." }
            ],
            "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞": [
                { val: "Volumetric lighting", desc: "–û–±—ä–µ–º–Ω—ã–π —Å–≤–µ—Ç (God rays). –õ—É—á–∏ —Å–≤–µ—Ç–∞, –ø—Ä–æ–±–∏–≤–∞—é—â–∏–µ—Å—è —á–µ—Ä–µ–∑ –¥—ã–º–∫—É –∏–ª–∏ –ø—ã–ª—å." },
                { val: "Cinematic lighting", desc: "–ö–∏–Ω–æ—à–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ. –î—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç, –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –æ–±—ä–µ–∫—Ç–µ." }
            ]
        },
        "–ö–∞–º–µ—Ä–∞": {
            "–†–∞–∫—É—Ä—Å": [
                { val: "Drone view", desc: "–í–∏–¥ —Å –¥—Ä–æ–Ω–∞. –°—ä–µ–º–∫–∞ —Å –±–æ–ª—å—à–æ–π –≤—ã—Å–æ—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–± –ª–æ–∫–∞—Ü–∏–∏." },
                { val: "Low angle shot", desc: "–ù–∏–∂–Ω–∏–π —Ä–∞–∫—É—Ä—Å. –ö–∞–º–µ—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö, –¥–µ–ª–∞—è –æ–±—ä–µ–∫—Ç –≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∏ –æ–≥—Ä–æ–º–Ω—ã–º." },
                { val: "Eye level", desc: "–ù–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑. –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –≤–∑–≥–ª—è–¥." },
                { val: "Top down view", desc: "–°—Ç—Ä–æ–≥–æ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (Flat lay). –•–æ—Ä–æ—à–æ –¥–ª—è —Å—Ö–µ–º, –∫–∞—Ä—Ç –∏–ª–∏ –Ω–∞—Ç—é—Ä–º–æ—Ä—Ç–æ–≤." }
            ],
            "–û–±—ä–µ–∫—Ç–∏–≤": [
                { val: "Macro shot", desc: "–ú–∞–∫—Ä–æ—Å—ä–µ–º–∫–∞. –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –±–ª–∏–∑–∫–æ, –≤–∏–¥–Ω–æ —Ç–µ–∫—Å—Ç—É—Ä—ã –∏ –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏." },
                { val: "Fisheye lens", desc: "–†—ã–±–∏–π –≥–ª–∞–∑. –°–∏–ª—å–Ω–æ–µ –∏—Å–∫–∞–∂–µ–Ω–∏–µ –ø–æ –∫—Ä–∞—è–º, –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏–π —É–≥–æ–ª –æ–±–∑–æ—Ä–∞." },
                { val: "35mm lens", desc: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç–∏–≤ 35–º–º. –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ, –∫–∞–∫ –≤ –∫–∏–Ω–æ." },
                { val: "Telephoto lens", desc: "–¢–µ–ª–µ–æ–±—ä–µ–∫—Ç–∏–≤. –°–∂–∏–º–∞–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É, —Ñ–æ–Ω –∫–∞–∂–µ—Ç—Å—è –±–ª–∏–∂–µ –∫ –æ–±—ä–µ–∫—Ç—É." }
            ]
        },
        "–°—Ç–∏–ª—å": {
            "–ê—Ä—Ç": [
                { val: "Oil painting", desc: "–ú–∞—Å–ª—è–Ω–∞—è –∂–∏–≤–æ–ø–∏—Å—å. –í–∏–¥–Ω—ã –º–∞–∑–∫–∏ –∫–∏—Å—Ç–∏, —Ç–µ–∫—Å—Ç—É—Ä–∞ —Ö–æ–ª—Å—Ç–∞." },
                { val: "Watercolor", desc: "–ê–∫–≤–∞—Ä–µ–ª—å. –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∫—Ä–∞—Å–∫–∏, –ø–æ—Ç–µ–∫–∏, –ª–µ–≥–∫–æ—Å—Ç—å." },
                { val: "Pencil sketch", desc: "–ö–∞—Ä–∞–Ω–¥–∞—à–Ω—ã–π –Ω–∞–±—Ä–æ—Å–æ–∫. –ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π, —à—Ç—Ä–∏—Ö–æ–≤–∫–∞, –≥—Ä–∞—Ñ–∏–∫–∞." },
                { val: "Pixel art", desc: "–ü–∏–∫—Å–µ–ª—å-–∞—Ä—Ç. –°—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ä—ã—Ö 8-–±–∏—Ç–Ω—ã—Ö –∏–≥—Ä." }
            ],
            "3D & Render": [
                { val: "Unreal Engine 5", desc: "–£–ª—å—Ç—Ä–∞-—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –∏–≥—Ä–æ–≤–æ–π –≥—Ä–∞—Ñ–∏–∫–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è." },
                { val: "Claymation", desc: "–ü–ª–∞—Å—Ç–∏–ª–∏–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è. –ú—è–≥–∫–∏–µ —Ñ–æ—Ä–º—ã, —Å—Ç–∏–ª—å '–£–æ–ª–ª–µ—Å –∏ –ì—Ä–æ–º–∏—Ç'." },
                { val: "Low poly", desc: "–ù–∏–∑–∫–æ–ø–æ–ª–∏–≥–æ–Ω–∞–ª—å–Ω–∞—è 3D –≥—Ä–∞—Ñ–∏–∫–∞. –£–≥–ª–æ–≤–∞—Ç—ã–µ —Ñ–æ—Ä–º—ã, –º–∏–Ω–∏–º–∞–ª–∏–∑–º." }
            ]
        }
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let activeParams = [];
    let tempSelection = null; // { val, desc }

    // === 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ï–õ–ï–ö–¢–û–†–û–í ===
    function initSelectors() {
        const groupSelect = document.getElementById('groupSelect');
        groupSelect.innerHTML = Object.keys(PROMPT_CONFIG).map(g => `<option value="${g}">${g}</option>`).join('');
        updateTypes();
    }

    function updateTypes() {
        const group = document.getElementById('groupSelect').value;
        const typeSelect = document.getElementById('typeSelect');
        typeSelect.innerHTML = Object.keys(PROMPT_CONFIG[group]).map(t => `<option value="${t}">${t}</option>`).join('');
        renderChips();
    }

    // === 3. –†–ï–ù–î–ï–† –ß–ò–ü–û–í (–ù–û–í–ê–Ø –§–ò–ß–ê) ===
    function renderChips() {
        const group = document.getElementById('groupSelect').value;
        const type = document.getElementById('typeSelect').value;
        const container = document.getElementById('chipsContainer');

        // –û—á–∏—Å—Ç–∫–∞
        container.innerHTML = '';
        document.getElementById('descriptionText').innerText = "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∏–ø, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ...";
        document.getElementById('addBtn').disabled = true;
        tempSelection = null;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
        PROMPT_CONFIG[group][type].forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'chip bg-slate-700 text-slate-200 px-4 py-2 rounded-full text-sm font-medium shadow-sm';
            btn.innerText = item.val;

            btn.onclick = () => {
                // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ —É –≤—Å–µ—Ö
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ
                btn.classList.add('active');
                // –ü–æ–∫–∞–∑ –æ–ø–∏—Å–∞–Ω–∏—è
                document.getElementById('descriptionText').innerText = item.desc;
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞
                tempSelection = { ...item, typeName: type };
                // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                document.getElementById('addBtn').disabled = false;
            };
            container.appendChild(btn);
        });
    }

    // === 4. –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ü–ò–°–ö–û–ú –ò DRAG & DROP ===

    function addSelectedParameter() {
        if(!tempSelection) return;

        const newParam = {
            id: Date.now(),
            type: tempSelection.typeName,
            value: tempSelection.val,
            desc: tempSelection.desc
        };

        activeParams.push(newParam);
        renderList();
        generatePrompt();
        closeModal();
    }

    function removeParam(id) {
        activeParams = activeParams.filter(p => p.id !== id);
        renderList();
        generatePrompt();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Drag & Drop
    function renderList() {
        const container = document.getElementById('activeModules');
        container.innerHTML = '';

        activeParams.forEach((param, index) => {
            const el = document.createElement('div');
            el.className = 'draggable-item glass-panel p-3 rounded-xl flex justify-between items-center border-l-4 border-yellow-500';
            el.setAttribute('draggable', 'true');
            el.dataset.index = index;

            el.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="cursor-grab text-slate-500 hover:text-white" title="–¢—è–Ω–∏ –º–µ–Ω—è">
                            <svg width="12" height="20" viewBox="0 0 6 10" fill="currentColor">
                                <circle cx="1" cy="1" r="1"/><circle cx="1" cy="5" r="1"/><circle cx="1" cy="9" r="1"/>
                                <circle cx="5" cy="1" r="1"/><circle cx="5" cy="5" r="1"/><circle cx="5" cy="9" r="1"/>
                            </svg>
                        </div>
                        <div>
                            <span class="text-[10px] uppercase text-slate-400 block tracking-wider">${param.type}</span>
                            <span class="text-white font-medium text-lg">${param.value}</span>
                        </div>
                    </div>
                    <button onclick="removeParam(${param.id})" class="text-slate-500 hover:text-red-400 p-2 text-xl">&times;</button>
                `;

            // –°–æ–±—ã—Ç–∏—è Drag & Drop
            addDnDEvents(el);

            container.appendChild(el);
        });
    }

    // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    let dragSrcIndex = null;

    function addDnDEvents(item) {
        item.addEventListener('dragstart', (e) => {
            dragSrcIndex = +item.dataset.index;
            item.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        });

        item.addEventListener('dragend', () => {
            item.classList.remove('dragging');
            document.querySelectorAll('.draggable-item').forEach(el => el.classList.remove('drag-over'));
        });

        item.addEventListener('dragover', (e) => {
            e.preventDefault();
            return false;
        });

        item.addEventListener('dragenter', () => {
            item.classList.add('drag-over');
        });

        item.addEventListener('dragleave', () => {
            item.classList.remove('drag-over');
        });

        item.addEventListener('drop', (e) => {
            e.stopPropagation();
            const dropIndex = +item.dataset.index;

            if (dragSrcIndex !== dropIndex) {
                // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –º–∞—Å—Å–∏–≤–µ
                const movedItem = activeParams[dragSrcIndex];
                activeParams.splice(dragSrcIndex, 1); // –£–¥–∞–ª—è–µ–º –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –º–µ—Å—Ç–∞
                activeParams.splice(dropIndex, 0, movedItem); // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –Ω–æ–≤–æ–µ

                renderList();
                generatePrompt();
            }
            return false;
        });
    }

    // === 5. –°–ë–û–†–ö–ê –ü–†–û–ú–¢–ê ===
    function generatePrompt() {
        const subject = document.getElementById('mainSubject').value.trim();
        let parts = [];

        if (subject) parts.push(subject);

        // –í–∞–∂–Ω–æ: –±–µ—Ä–µ–º –ø–æ—Ä—è–¥–æ–∫ –∏–∑ –º–∞—Å—Å–∏–≤–∞ activeParams, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ Drag&Drop
        activeParams.forEach(p => parts.push(p.value));

        const finalStr = parts.join(', ');

        const out = document.getElementById('finalPrompt');
        if(finalStr) {
            out.innerText = finalStr;
            out.classList.remove('text-slate-500');
            out.classList.add('text-white');
        } else {
            out.innerText = "–î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ–∫—Å—Ç...";
            out.classList.add('text-slate-500');
        }
    }

    function copyPrompt() {
        const text = document.getElementById('finalPrompt').innerText;
        navigator.clipboard.writeText(text);
        const btn = document.querySelector('button[onclick="copyPrompt()"]');
        const old = btn.innerText;
        btn.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! ‚úÖ";
        setTimeout(() => btn.innerText = old, 2000);
    }

    function openModal() {
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('modal').classList.add('flex');
        // –°–±—Ä–æ—Å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        document.getElementById('addBtn').disabled = true;
        document.getElementById('descriptionText').innerText = "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∏–ø...";
    }
    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    // –ó–∞–ø—É—Å–∫
    document.getElementById('mainSubject').addEventListener('input', generatePrompt);
    initSelectors();

</script>
</body>
</html>